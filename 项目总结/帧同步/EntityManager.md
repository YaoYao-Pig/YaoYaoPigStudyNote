# EntityManager

EntityManager的设计我主要是为了统一一个实体的回滚入口，并且当实体存在本身需要回滚的时候有一个处理的地方



## 回滚



```mermaid 
graph LR
    A[总实体数量 N] --> B[实体1 数据块]
    B --> C[实体2 数据块]
    C --> D[...]
    D --> E[实体N 数据块]
```





```cpp
[ 整个世界的二进制快照 ]

+-------------------------------------------------------+
| 实体总数 (int) : 2                                     |
+-------------------------------------------------------+
| [实体1 头信息]                                         |
|   - EntityId (int) : 100001                           |
|   - PrefabId (int) : 1 (Player)                       |
|-------------------------------------------------------|
| [实体1 身体数据 (由 PlayerEntity 解析)]                 |
|   - PlayerIndex (int)    : 1                          |
|   - Position (Vector3)   : (100, 0, 50)               |
|   - Velocity (Vector3)   : (0, 0, 0)                  |
|   - State (byte)         : 1 (Move)                   |
|   - StateTime (LFloat)   : 0.5                        |
|   - ...                                               |
+-------------------------------------------------------+
| [实体2 头信息]                                         |
|   - EntityId (int) : 100002                           |
|   - PrefabId (int) : 2 (Chest)                        |
|-------------------------------------------------------|
| [实体2 身体数据 (由 InteractiveEntity 解析)]            |
|   - ItemCount (int)      : 1                          |
|   - [物品1]                                            |
|       - ItemEID (int)    : 100003                     |
|       - ItemID (int)     : 501 (Apple)                |
|       - Count (int)      : 10                         |
+-------------------------------------------------------+
```

![image-20251201165005970](assets/image-20251201165005970.png)

![image-20251201165013427](assets/image-20251201165013427.png)